# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarQube –Ω–∞ Ubuntu/Debian —Å Postgres Pro (–¥–ª—è 1–°)

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç** –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ [SonarQube Community Edition](https://www.sonarsource.com/products/sonarqube/) –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∞ –±–∞–∑–µ Debian/Ubuntu —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **PostgreSQL Pro 16 —Å –ø–∞—Ç—á–∞–º–∏ –¥–ª—è 1–°**.

–°–∫—Ä–∏–ø—Ç:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Java 17
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Postgres Pro 16 –¥–ª—è 1–°
- –°–æ–∑–¥–∞—ë—Ç –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è SonarQube
- –°–∫–∞—á–∏–≤–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é SonarQube
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã (`nofile`, `nproc`, `vm.max_map_count`)
- –°–æ–∑–¥–∞—ë—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `sonar`
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `sonar.properties`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç **–¥–≤–∞ systemd-—Å–µ—Ä–≤–∏—Å–∞**:
  - `sonarqube.service` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–µ–∂–∏–º (production)
  - `sonarqube-console.service` ‚Äî —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (–≤—Å–µ –ª–æ–≥–∏ –≤ `journalctl`)

---

## üì• –ì–¥–µ –≤–∑—è—Ç—å –≤–µ—Ä—Å–∏—é SonarQube?

**SonarQube –ù–ï –ø—É–±–ª–∏–∫—É–µ—Ç –≤–µ—Ä—Å–∏–∏ –≤ –≤–∏–¥–µ `25.3.0`!**  
–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–ª–∏–∑—ã ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º –∑–µ—Ä–∫–∞–ª–µ:

üëâ **https://binaries.sonarsource.com/?prefix=Distribution/sonarqube/**

–ü—Ä–∏–º–µ—Ä—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∏–º—ë–Ω –∞—Ä—Ö–∏–≤–æ–≤:
- `sonarqube-9.9.8.100196.zip`
- `sonarqube-10.4.1.92868.zip`

‚ùó **–í—ã –æ–±—è–∑–∞–Ω—ã —Å–∞–º–∏ –≤—ã–±—Ä–∞—Ç—å –≤–µ—Ä—Å–∏—é** –∏ —É–∫–∞–∑–∞—Ç—å –µ—ë –≤ —Å–∫—Ä–∏–ø—Ç–µ (–ø–∞—Ä–∞–º–µ—Ç—Ä `SONARQUBE_VERSION` ‚Äî —Ç–æ–ª—å–∫–æ –∏–º—è –±–µ–∑ `.zip`).

---

## ‚ñ∂Ô∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/hawk2012/sonarqube-install.git
   cd sonarqube-install
   ```

2. –û—Ç–∫—Ä–æ–π—Ç–µ `install-sonarqube.sh` –∏ —É–∫–∞–∂–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é:
   ```bash
   SONARQUBE_VERSION="sonarqube-9.9.8.100196"  # ‚Üê —Å—é–¥–∞!
   ```

   –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ:
   - `DB_USER`, `DB_PASS`, `DB_NAME`
   - `INSTALL_DIR`, `SONAR_USER`

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç root:
   ```bash
   chmod +x install-sonarqube.sh
   sudo ./install-sonarqube.sh
   ```

4. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
   ```bash
   # –ó–∞–ø—É—Å–∫ –≤ production-—Ä–µ–∂–∏–º–µ
   sudo systemctl start sonarqube

   # –ò–ª–∏ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏ (–ª–æ–≥–∏ –≤ journalctl)
   sudo systemctl start sonarqube-console

   # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   sudo systemctl status sonarqube
   sudo journalctl -u sonarqube -f
   ```

5. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://<–≤–∞—à_—Å–µ—Ä–≤–µ—Ä>:9000`  
   –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `admin` / `admin`

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –°–∫—Ä–∏–ø—Ç **–ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —á–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã** (Ubuntu 20.04/22.04, Debian 11/12).
- –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ `sonarqube` –∏ `sonarqube-console` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –±—É–¥–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç.
- –î–ª—è production **–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `sonarqube.service`**, –∞ –Ω–µ `console`.
- –ï—Å–ª–∏ –≤—ã **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ 1–°**, –∑–∞–º–µ–Ω–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É Postgres Pro –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `postgresql`.

---

## üõ† –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### ‚ùå `can not run elasticsearch as root`
**–ü—Ä–∏—á–∏–Ω–∞:** SonarQube (–∞ —Ç–æ—á–Ω–µ–µ ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Elasticsearch) –∑–∞–ø—É—â–µ–Ω –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `root`.  
**–†–µ—à–µ–Ω–∏–µ:**  
–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –Ω–∞–ø—Ä—è–º—É—é –æ—Ç root. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
sudo -u sonar /opt/sonarqube/bin/linux-x86-64/sonar.sh console
```
–ò–ª–∏ ‚Äî –ª—É—á—à–µ ‚Äî systemd-—é–Ω–∏—Ç:
```bash
sudo systemctl start sonarqube
```

---

### ‚ùå `FileNotFoundException: /opt/sonarqube/temp/sharedmemory (Permission denied)`
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞–ø–∫–∞ `/opt/sonarqube/temp` (–∏–ª–∏ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ) –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç `root` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –æ—Ç root.  
**–†–µ—à–µ–Ω–∏–µ:**  
–°–±—Ä–æ—Å—å—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤—Å–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
```bash
sudo chown -R sonar:sonar /opt/sonarqube
sudo rm -rf /opt/sonarqube/temp/*
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `sonar`.

---

### ‚ùå `max virtual memory areas vm.max_map_count [65530] is too low`
**–ü—Ä–∏—á–∏–Ω–∞:** –Ø–¥—Ä–æ Linux –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∏—Å–ª–æ memory-mapped –æ–±–ª–∞—Å—Ç–µ–π ‚Äî Elasticsearch –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è.  
**–†–µ—à–µ–Ω–∏–µ:**  
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `/etc/sysctl.conf` –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞:
```conf
vm.max_map_count = 262144
```
–ò –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
sudo sysctl -p
```

---

### ‚ùå `Too many open files` –∏–ª–∏ `Cannot create new thread`
**–ü—Ä–∏—á–∏–Ω–∞:** –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞ —á–∏—Å–ª–æ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ.  
**–†–µ—à–µ–Ω–∏–µ:**  
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ `/etc/security/limits.conf` –µ—Å—Ç—å:
```conf
sonar soft nofile 65536
sonar hard nofile 65536
sonar soft nproc 4096
sonar hard nproc 4096
```
> ‚ö†Ô∏è –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è **–ø–µ—Ä–µ–ª–æ–≥–∏–Ω** –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ (–¥–ª—è systemd ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞, –µ—Å–ª–∏ –ª–∏–º–∏—Ç—ã –∑–∞–¥–∞–Ω—ã –≤ —é–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ `LimitNOFILE`/`LimitNPROC`).

---

### ‚ùå PostgreSQL –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª—É–∂–±–∞ `postgrespro-1c-16` –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞, –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–ë–î –Ω–µ —Å–æ–∑–¥–∞–Ω—ã.  
**–†–µ—à–µ–Ω–∏–µ:**
```bash
sudo systemctl status postgrespro-1c-16
sudo systemctl start postgrespro-1c-16
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ë–î `sonarqube` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
sudo -u postgres psql -d sonarqube -c "SELECT 1;"
```

---

## üõ† –ê–≤—Ç–æ—Ä
–ú–∏—Ö–∞–∏–ª –ì—É–±–∏–Ω, DevOps –∏–Ω–∂–µ–Ω–µ—Ä  
–°–æ–±—Ä–∞–Ω–æ —Å —É—á—ë—Ç–æ–º —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ —Å—Ç–∞—Ç—å—è—Ö (—Å–∫–∞—á—É—â–∏–µ –≤–µ—Ä—Å–∏–∏, —Ä—É—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –æ–ø–µ—á–∞—Ç–∫–∏).  
